# Figma Token 저장 방식 비교

## 방법 비교

### 방법 1: 서버 환경 변수 (제안하신 방법)
```env
FIGMA_TOKEN=your-token-here
```

**장점:**
- ✅ 서버에서 관리되어 보안상 안전
- ✅ 코드에 하드코딩되지 않음
- ✅ 배포 시 한 번만 설정

**단점:**
- ❌ 모든 사용자가 같은 토큰 사용 (개인 토큰 사용 불가)
- ❌ 사용자별로 다른 토큰 설정 불가
- ❌ 토큰 변경 시 서버 재시작 필요

**적합한 경우:**
- 팀 공용 토큰 사용
- 단일 사용자 환경
- 서버에서 통합 관리 필요

---

### 방법 2: 로컬 스토리지 (LocalStorage) ⭐ **권장**

**장점:**
- ✅ 사용자별로 다른 토큰 저장 가능
- ✅ 새로고침해도 유지됨
- ✅ 서버에 노출되지 않음 (클라이언트에만 저장)
- ✅ 토큰 변경 시 즉시 반영
- ✅ 암호화하여 저장 가능

**단점:**
- ⚠️ 브라우저별로 저장 (다른 브라우저에서는 재입력 필요)
- ⚠️ 클라이언트에 저장되므로 XSS 공격에 취약할 수 있음 (하지만 서버로 전송되지 않으므로 상대적으로 안전)

**적합한 경우:**
- 개인 토큰 사용
- 사용자별 설정 필요
- 가장 실용적인 방법

---

### 방법 3: 하이브리드 접근 ⭐⭐⭐ **최적**

**구조:**
```
1. 서버 환경 변수: 기본값 (팀 공용 토큰)
   ↓ (없으면)
2. 로컬 스토리지: 개인 토큰
   ↓ (없으면)
3. 사용자 입력 요청
```

**장점:**
- ✅ 팀 공용 토큰 기본 사용
- ✅ 개인 토큰으로 오버라이드 가능
- ✅ 유연성과 편의성 모두 확보
- ✅ 보안과 사용성 균형

**적합한 경우:**
- **대부분의 경우에 최적**
- 팀 공용 + 개인 토큰 모두 지원

---

## 권장 구현: 하이브리드 접근

### 구조

```
┌─────────────────────────────────────┐
│  서버 환경 변수 (FIGMA_TOKEN)       │
│  → 팀 공용 토큰 (기본값)            │
└──────────────┬──────────────────────┘
               │
               ↓ 없으면
┌─────────────────────────────────────┐
│  로컬 스토리지 (figma_token)        │
│  → 개인 토큰 (사용자별)             │
└──────────────┬──────────────────────┘
               │
               ↓ 없으면
┌─────────────────────────────────────┐
│  사용자 입력 요청                    │
└─────────────────────────────────────┘
```

### 동작 방식

1. **서버에서 환경 변수 확인** (서버 사이드)
   - `process.env.FIGMA_TOKEN` 존재 시 기본값으로 사용
   - API 엔드포인트에서 토큰이 없을 때만 환경 변수 사용

2. **로컬 스토리지 확인** (클라이언트 사이드)
   - `localStorage.getItem('figma_token')` 확인
   - 있으면 사용, 없으면 서버 환경 변수 사용

3. **사용자 입력**
   - 둘 다 없으면 사용자에게 입력 요청
   - 입력한 토큰은 로컬 스토리지에 저장

---

## 구현 예시

### 클라이언트 (page.tsx)
```typescript
// 로컬 스토리지에서 토큰 가져오기
const [figmaToken, setFigmaToken] = useState<string>(() => {
  if (typeof window !== 'undefined') {
    return localStorage.getItem('figma_token') || '';
  }
  return '';
});

// 토큰 저장
const saveToken = (token: string) => {
  setFigmaToken(token);
  if (typeof window !== 'undefined') {
    localStorage.setItem('figma_token', token);
  }
};
```

### 서버 (API Route)
```typescript
// 환경 변수에서 기본 토큰 가져오기
const defaultToken = process.env.FIGMA_TOKEN;

// 클라이언트에서 토큰이 없으면 서버 기본값 사용
const tokenToUse = token || defaultToken;
```

---

## 보안 고려사항

### 로컬 스토리지 보안
- 토큰은 평문으로 저장되지만, 서버로 전송되지 않음
- XSS 공격에 취약할 수 있으므로:
  - Content Security Policy (CSP) 설정
  - 입력값 검증
  - HTTPS 사용

### 서버 환경 변수 보안
- `.env` 파일을 `.gitignore`에 추가
- 프로덕션에서는 환경 변수로 설정
- 토큰은 절대 코드에 하드코딩하지 않기

---

## 결론 및 권장사항

### ⭐⭐⭐ 하이브리드 접근 (최적)

**이유:**
1. 팀 공용 토큰 기본 사용 가능
2. 개인 토큰으로 오버라이드 가능
3. 사용자 편의성과 보안 모두 확보
4. 유연한 설정 가능

**구현 순서:**
1. 로컬 스토리지에 토큰 저장 기능 추가
2. 서버 환경 변수 지원 추가 (선택)
3. UI에 "토큰 저장" 옵션 추가

### 대안: 로컬 스토리지만 사용

하이브리드가 복잡하다면, **로컬 스토리지만 사용**하는 것도 좋은 선택입니다:
- 구현이 간단함
- 사용자별 설정 가능
- 새로고침해도 유지됨


