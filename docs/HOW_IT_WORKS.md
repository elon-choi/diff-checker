# Diff Checker 작동 원리

## 핵심: 구조화되지 않은 위키 문서도 비교 가능합니다!

### 현재 구현된 기능

#### 1. 역방향 비교 (Figma → Spec) ✅ 구현 완료

**작동 방식**:
```
Figma: "필터" 버튼
  ↓
위키 문서 전체 텍스트에서 "필터" 키워드 검색
  ↓
"필터 버튼을 통해 정렬 옵션을 선택할 수 있으며" 발견
  ↓
✅ 매칭 성공 (언급됨)
```

**결과**: 자연어 설명이 있어도 비교 가능!

#### 2. 정방향 비교 (Spec → Figma) ✅ 구현 완료

**작동 방식**:
```
위키: "필터" (따옴표로 감싼 텍스트)
  ↓
Figma에서 "필터" 텍스트 검색
  ↓
✅ 매칭 성공
```

**결과**: 구조화된 항목은 정확히 비교

#### 3. 메타데이터 자동 필터링 ✅ 구현 완료

**작동 방식**:
- 티켓 번호, UUID, 날짜 등 자동 제외
- UI 관련 키워드만 추출

**결과**: False Positive 대폭 감소

#### 4. LLM 후처리 ✅ 구현 완료 (선택사항)

**작동 방식**:
- 의미적으로 동일한 findings 병합
- 설명 개선
- 중복 제거

**결과**: 더 정확하고 읽기 쉬운 결과

## 실제 사용 시나리오

### 시나리오 1: 구조화되지 않은 위키 문서

**위키 문서**:
```
시간표 화면에 정렬 기능을 추가합니다.
사용자는 필터 버튼을 통해 정렬 옵션을 선택할 수 있으며,
원기소, 조회순 등의 옵션이 제공됩니다.
```

**Figma**:
- 버튼: "필터"
- 옵션: "원기소", "조회순"

**비교 결과**:
- ✅ "필터" → 위키에 "필터 버튼" 언급 → 매칭
- ✅ "원기소" → 위키에 "원기소" 언급 → 매칭
- ✅ "조회순" → 위키에 "조회순" 언급 → 매칭
- ⚠️ 차이 없음 (또는 실제 차이만 표시)

### 시나리오 2: 구조화된 위키 문서

**위키 문서**:
```
"필터" 버튼 노출
"정렬 선택" 섹션에 "원기소", "조회순" 옵션
```

**Figma**:
- 버튼: "필터"
- 옵션: "원기소", "조회순"

**비교 결과**:
- ✅ 정확한 텍스트 매칭
- ✅ 더 정확한 비교

### 시나리오 3: 하이브리드 (자연어 + 구조화)

**위키 문서**:
```
시간표 화면에 정렬 기능을 추가합니다.

UI 요소:
- "필터" 버튼
- "정렬 선택" 섹션
  - "원기소" 옵션
  - "조회순" 옵션
```

**비교 결과**:
- ✅ 구조화된 항목: 정확한 매칭
- ✅ 자연어 설명: 역방향 비교로 검증
- ✅ 최고의 정확도

## 왜 작동하는가?

### 1. 다층 비교 전략

```
Layer 1: 역방향 비교 (Figma → Spec)
  → 자연어 Spec도 처리 가능

Layer 2: 정방향 비교 (Spec → Figma)
  → 구조화된 항목 정확히 비교

Layer 3: LLM 후처리 (선택)
  → 의미 기반 정제
```

### 2. 유연한 매칭

- **키워드 매칭**: "필터"가 "필터 버튼"에 포함되면 매칭
- **부분 매칭**: "원기소"가 "원기소, 조회순"에 포함되면 매칭
- **유사도 매칭**: 텍스트 유사도로 매칭

### 3. 스마트 필터링

- 메타데이터 자동 제외
- UI 관련 키워드만 추출
- False Positive 최소화

## 실제 사용 예시

### 예시 1: 완전히 자연어인 경우

**위키**:
```
이번 업데이트에서는 사용자가 원하는 방식으로 작품을 정렬할 수 있는 기능을 추가합니다.
화면 상단에 있는 필터 아이콘을 클릭하면 정렬 옵션이 나타나며,
사용자는 최신순, 인기순, 조회순 중에서 선택할 수 있습니다.
```

**Figma**: "필터", "최신순", "인기순", "조회순"

**결과**:
- ✅ "필터" → 위키에 "필터 아이콘" 언급 → 매칭
- ✅ "최신순" → 위키에 "최신순" 언급 → 매칭
- ✅ "인기순" → 위키에 "인기순" 언급 → 매칭
- ✅ "조회순" → 위키에 "조회순" 언급 → 매칭

### 예시 2: 일부만 구조화된 경우

**위키**:
```
정렬 기능 추가

"필터" 버튼 클릭 시
- "최신순"
- "인기순"  
- "조회순"

사용자는 원하는 옵션을 선택할 수 있습니다.
```

**Figma**: "필터", "최신순", "인기순", "조회순"

**결과**:
- ✅ 구조화된 항목: 정확한 매칭
- ✅ 자연어 설명: 역방향 비교로 검증
- ✅ 모든 항목 매칭 성공

## 결론

**구조화되지 않은 위키 문서도 비교 가능합니다!**

이유:
1. ✅ 역방향 비교로 자연어도 처리
2. ✅ 정방향 비교로 구조화된 항목 정확히 비교
3. ✅ 메타데이터 자동 필터링
4. ✅ LLM 후처리로 정확도 향상

**사용 방법**:
1. 위키 문서 입력 (어떤 형식이든 가능)
2. Figma JSON 입력
3. 비교 실행
4. 결과 확인

**결과**:
- 실제 UI 차이만 표시
- False Positive 최소화
- 실용적인 비교 결과


